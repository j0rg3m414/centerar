(function(b){b.fn.gMap=function(a,d){switch(a){case"addMarker":return b(this).trigger("gMap.addMarker",[d.latitude,d.longitude,d.content,d.icon,d.popup]);case"centerAt":return b(this).trigger("gMap.centerAt",[d.latitude,d.longitude,d.zoom])}opts=b.extend({},b.fn.gMap.defaults,a);return this.each(function(){var g=new google.maps.Map(this);$geocoder=new google.maps.Geocoder,opts.address?$geocoder.geocode({address:opts.address},function(e,f){e.length>0&&g.setCenter(e[0].geometry.location)}):opts.latitude&&opts.longitude?g.setCenter(new google.maps.LatLng(opts.latitude,opts.longitude)):b.isArray(opts.markers)&&opts.markers.length>0?opts.markers[0].address?$geocoder.geocode({address:opts.markers[0].address},function(e,f){e.length>0&&g.setCenter(e[0].geometry.location)}):g.setCenter(new google.maps.LatLng(opts.markers[0].latitude,opts.markers[0].longitude)):g.setCenter(new google.maps.LatLng(34.885931,9.84375)),g.setZoom(opts.zoom),g.setMapTypeId(google.maps.MapTypeId[opts.maptype]),map_options={scrollwheel:opts.scrollwheel},opts.controls===!1?b.extend(map_options,{disableDefaultUI:!0}):opts.controls.length!=0&&b.extend(map_options,opts.controls,{disableDefaultUI:!0}),g.setOptions(map_options);var k=new google.maps.Marker;marker_icon=new google.maps.MarkerImage(opts.icon.image),marker_icon.size=new google.maps.Size(opts.icon.iconsize[0],opts.icon.iconsize[1]),marker_icon.anchor=new google.maps.Point(opts.icon.iconanchor[0],opts.icon.iconanchor[1]),k.setIcon(marker_icon),opts.icon.shadow&&(marker_shadow=new google.maps.MarkerImage(opts.icon.shadow),marker_shadow.size=new google.maps.Size(opts.icon.shadowsize[0],opts.icon.shadowsize[1]),marker_shadow.anchor=new google.maps.Point(opts.icon.shadowanchor[0],opts.icon.shadowanchor[1]),k.setShadow(marker_shadow)),b(this).bind("gMap.centerAt",function(f,n,m,l){l&&g.setZoom(l),g.panTo(new google.maps.LatLng(parseFloat(n),parseFloat(m)))});var j;b(this).bind("gMap.addMarker",function(t,s,r,q,p,o){var n=new google.maps.LatLng(parseFloat(s),parseFloat(r)),m=new google.maps.Marker({position:n});p?(marker_icon=new google.maps.MarkerImage(p.image),marker_icon.size=new google.maps.Size(p.iconsize[0],p.iconsize[1]),marker_icon.anchor=new google.maps.Point(p.iconanchor[0],p.iconanchor[1]),m.setIcon(marker_icon),p.shadow&&(marker_shadow=new google.maps.MarkerImage(p.shadow),marker_shadow.size=new google.maps.Size(p.shadowsize[0],p.shadowsize[1]),marker_shadow.anchor=new google.maps.Point(p.shadowanchor[0],p.shadowanchor[1]),k.setShadow(marker_shadow))):(m.setIcon(k.getIcon()),m.setShadow(k.getShadow()));if(q){q=="_latlng"&&(q=s+", "+r);var c=new google.maps.InfoWindow({content:opts.html_prepend+q+opts.html_append});google.maps.event.addListener(m,"click",function(){j&&j.close(),c.open(g,m),j=c}),o&&c.open(g,m)}m.setMap(g)});for(var i=0;i<opts.markers.length;i++){marker=opts.markers[i];if(marker.address){marker.html=="_address"&&(marker.html=marker.address);var h=this;$geocoder.geocode({address:marker.address},function(e,f){return function(l,c){l.length>0&&b(f).trigger("gMap.addMarker",[l[0].geometry.location.lat(),l[0].geometry.location.lng(),e.html,e.icon])}}(marker,h))}else{b(this).trigger("gMap.addMarker",[marker.latitude,marker.longitude,marker.html,marker.icon])}}})},b.fn.gMap.defaults={address:"",latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:!1,maptype:"ROADMAP",html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}})(jQuery);